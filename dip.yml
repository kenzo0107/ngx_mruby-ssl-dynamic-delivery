version: '6.1'

compose:
  files:
    - docker-compose.yml

interaction:
  bash:
    description: Open the Bash shell in nginx's container
    service: nginx
    command: bash

  'redis-cli':
    description: Run Redis console
    service: redis
    command: redis-cli -h redis

provision:
  - sh crt.sh localhost
  - dip compose up -d redis
  - |
    dip redis-cli hmset localhost \
      crt \""$(awk 'NF {sub(/\r/, ""); printf "%s\n",$0;}' certs/localhost.crt)"\" \
      key \""$(awk 'NF {sub(/\r/, ""); printf "%s\n",$0;}' certs/localhost.key)"\"
